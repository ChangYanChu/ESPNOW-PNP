# Hand端LED状态指示系统设计

## LED状态指示概览

Hand端的LED状态指示系统经过优化，现在提供了多种友好的视觉反馈，帮助用户快速了解设备状态。

## LED状态类型

### 1. 基础状态指示

#### LED_STATUS_OFF (关闭)
- **描述**: LED完全关闭
- **使用场景**: 设备未初始化或故障状态
- **视觉效果**: 无光

#### LED_STATUS_WIFI_CONNECTING (WiFi连接中)
- **描述**: WiFi正在连接过程中
- **使用场景**: 设备启动时连接WiFi
- **视觉效果**: 慢速闪烁 (500ms间隔)
- **持续时间**: 直到WiFi连接成功

#### LED_STATUS_WIFI_CONNECTED (WiFi已连接，未分配ID)
- **描述**: WiFi连接成功但尚未分配Feeder ID
- **使用场景**: 新设备首次连接或ID被重置
- **视觉效果**: 超慢闪烁 (2秒间隔)
- **持续时间**: 直到分配ID

#### LED_STATUS_READY (就绪状态)
- **描述**: 设备已分配ID并准备工作
- **使用场景**: 正常工作状态，等待命令
- **视觉效果**: 心跳闪烁 (每秒快闪50ms)
- **持续时间**: 持续状态

#### LED_STATUS_WORKING (工作中)
- **描述**: 设备正在执行送料动作
- **使用场景**: 执行G-code命令时
- **视觉效果**: 快速闪烁 (100ms间隔)，通常3次闪烁
- **持续时间**: 动作完成后自动返回就绪状态

### 2. 特殊功能指示

#### LED_BLINK_FIND_ME (Find Me功能)
- **描述**: 用户触发的设备定位功能
- **使用场景**: 在Web界面点击"Find Me"按钮
- **视觉效果**: 中慢速闪烁 (300ms间隔)
- **持续时间**: 10秒
- **优先级**: 最高，会覆盖其他LED状态

#### LED_BLINK_ERROR (错误指示)
- **描述**: 命令执行失败或系统错误
- **使用场景**: 送料失败、通信错误等
- **视觉效果**: 中速闪烁 (200ms间隔)
- **持续时间**: 3次闪烁后返回之前状态

#### LED_BLINK_SUCCESS (成功指示)
- **描述**: 命令执行成功确认
- **使用场景**: 送料动作完成、ID设置成功等
- **视觉效果**: 中快速闪烁 (150ms间隔)
- **持续时间**: 3次闪烁后返回之前状态

## LED状态流转图

```
[设备启动] 
    ↓
[LED_STATUS_WIFI_CONNECTING] (慢闪)
    ↓ (WiFi连接成功)
[LED_STATUS_WIFI_CONNECTED] (超慢闪) 或 [LED_STATUS_READY] (心跳)
    ↓ (分配ID)
[LED_STATUS_READY] (心跳闪烁)
    ↓ (收到命令)
[LED_STATUS_WORKING] (快闪) → [LED_STATUS_READY] (返回)
    ↓ (Find Me命令)
[LED_BLINK_FIND_ME] (10秒中慢闪) → [原状态] (返回)
```

## 优化特性

### 1. 优先级系统
- Find Me功能具有最高优先级，可以覆盖任何其他LED状态
- 错误和成功指示会临时覆盖状态指示，完成后自动返回
- 工作状态会覆盖就绪状态，完成后自动返回

### 2. 智能状态管理
- 自动检测WiFi连接状态并相应调整LED
- 根据Feeder ID分配情况智能选择状态
- 支持状态记忆，Find Me结束后返回之前状态

### 3. 用户友好设计
- 不同的闪烁频率代表不同含义，易于区分
- 心跳闪烁表示正常工作，给用户安心感
- Find Me功能持续时间足够长，便于定位设备

## 状态指示含义速查表

| LED状态 | 闪烁模式 | 含义 | 用户操作建议 |
|---------|----------|------|--------------|
| 关闭 | 无光 | 设备未启动或故障 | 检查电源连接 |
| 慢闪(500ms) | 连续 | WiFi连接中 | 等待连接完成 |
| 超慢闪(2s) | 连续 | 已连接但未分配ID | 在Web界面分配ID |
| 心跳闪(1s) | 连续 | 就绪状态 | 设备正常，可发送命令 |
| 快闪(100ms) | 3次 | 执行送料动作 | 动作执行中，请等待 |
| 中慢闪(300ms) | 10秒 | Find Me激活 | 设备正在指示位置 |
| 中速闪(200ms) | 3次 | 错误发生 | 检查命令或设备状态 |
| 中快闪(150ms) | 3次 | 操作成功 | 命令执行完成 |

## 实现细节

### 硬件要求
- GPIO Pin 1 用作LED控制
- 支持PWM输出（简单高低电平即可）
- 在DEBUG模式下LED功能被禁用以避免与串口冲突

### 软件架构
- 非阻塞式LED控制，不影响主循环性能
- 状态机管理，确保LED状态转换逻辑正确
- 定时器驱动，精确控制闪烁时间

### 能耗优化
- LED仅在需要时点亮，降低功耗
- 心跳闪烁使用短暂点亮(50ms)，节省电力
- Find Me功能有时间限制，避免长期高功耗

这套LED状态指示系统为Hand端设备提供了直观、友好的状态反馈，用户可以通过LED状态快速判断设备状态并采取相应行动。
